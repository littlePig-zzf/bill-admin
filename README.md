# 账单模块

## Getting Started

在项目目录中, 打开命令行工具, 执行 `yarn`命令进行安装依赖

```bash
$ yarn
```

安装完成之后, 运行项目, 在命令行中输入: `npm start`, 

```bash
$ npm start
```

运行成功后, 在浏览器地址栏输入: http://localhost:8000/ 进行访问.

&nbsp;


### **题目思考过程:**

#### **一、题目需求的拆分:**

​	1-1、账单列表: 

​&ensp;&ensp;1、有搜索项(月份、账单类型)进行过滤列表

​&ensp;&ensp;2、有新增账单按钮(账单属性不多, 考虑以弹窗的形式, 方便交互)

​	1-2、新增账单, 新增账单的属性: 账单类型、账单分类、账单金额. (注: 账单分类根据账单类型过滤)

​	1-3、账单统计报表:

​&ensp;&ensp;1、存在筛选项: 月份

​&ensp;&ensp;2、统计全部、或者该月份的收入支出总金额, 以柱状图的形式展示

​&ensp;&ensp;3、根据账单分类, 分别统计全部、或者该月份的收入支出明细金额, 并根据金额大小对柱状图进行排序  

&nbsp;


#### **二、 初始化搭建项目**

1、使用umi.js框架初始化`React + typescript`项目, 配置layout、路由、封装Axios接口请求.

2、根据题意下载了 csv数据文件, google了一个第三方插件[Papa Parse ](https://www.papaparse.com/), 将csv文件转换成对应的json数据.

3、拿到转换后的json数据, 配置mock请求.

&nbsp;


#### **三、实现功能**

**1、账单列表**

1.1、实现多个筛选项过滤列表

ps: 遍历列表源数据 `list` , 增加月份month的字段, 以及账单类型的字段, 方便跟筛选项字段进行比对.

​&ensp;&ensp;	使用了`filter`方法, 配合`for in` 来循环筛选项数据`params`, 判断条件为: list 对应字段的值为`undefined`、或者和筛选项params的值不相等, 则返回false, 否则true. (注: 需要过滤掉筛选项 params 中字段为空的字段).

&nbsp;




**2、账单报表**

  2.1、对统计数据的计算  

​	&ensp;&ensp;由于使用echarts, 则需要对收入、支出的数据进行分类、并统计和, 同时还得根据金额进行排序.

​	&ensp;&ensp;根据echarts的数据, 需要计算出支出、收入的xAxis横坐标数据, 即账单类型;  还需要计算对应账单类型的总金额.

&nbsp;

ps: 

1、获取全部数据、或者当前月份的数据, 包含了: 所有的支出、收入.

2、根据账单分类进行分组: 支出、收入. 使用lodash的`groupBy`, 得到数据格式为:  `[0: [...], 1: [...]]`

3、得到的分组数据存在多个同样的账单类型, 需要合并账单类型, 对金额进行叠加

4、创建一个新对象 `obj`, 遍历这两分组数据, 判断账单类型是否存在进行设置obj.

如果不存在, 增加在新对象obj中, 数据格式: `{categoryId: amount, ...}`  否则, 获取上一次的金额, 进行叠加. 

(注: 考虑到横坐标使用账单类型文本显示, 所以这里的key 需要转换成对应的 categoryName, 由于list数组中不存在categoryName, 则需要从账单分类中取)

5、获取账单分类的数据category, 并处理成 `categoryId: categoryName`的形式. 在第4步遍历分组数据时, 使用 categoryId 获取到相应的name作为key.

6、此时得到的新对象obj 是 `{车贷: 122, ....}`, 并对重复的账单类型进行了合并.

&nbsp;


**如果是计算收入、支出总金额的话, 需要使用`reduce`对金额进行汇总, 先使用`Object.values`获取到金额数组即可.**

**如果是需要支出、收入明细金额的话, 还需要进行排序.**

&nbsp;


7、接下来针对新对象 obj 进行排序, 需创建一个数组 arr, 对新对象obj进行转换成数组格式: `[车贷: 122, ...]`, 然后使用`sort`排序. 得到排序后的数据为: `let sortData = [[车贷: 122, ...]]`

8、遍历sortData数据, 拼成 xAxis横坐标, 和对应坐标的 金额数据.

9、最后将获取到的值设置到echarts的options中即可.

